# Kitsu

[![npm badge]][npm]
[![npm install badge]][npm]
[![david badge]][david]
[![contributors badge]][contributors]
[![donate badge]][donate]

[![travis badge]][travis]
[![appveyor badge]][appveyor]
[![david dev badge]][david dev]
[![cc maintainability badge]][cc maintainability]
[![cc coverage badge]][cc coverage]

A simple, lightweight & framework agnostic [JSON:API] client for [Kitsu.io] and other APIs

_Check out the [Migration Guide] for breaking changes and new features in `5.x`_

## Features

-   JSON-API 1.0 compliant
-   Automatically links relationships to data
-   Works in Node and on the web
-   Uses the [Promise] API
-   Configurable timeout handling

## Node / Browser Support

|        Package | Package<br> Size\* | Node | Chrome | Firefox | Safari | Edge |  IE |
| -------------: | :----------------: | :--: | :----: | :-----: | :----: | :--: | :-: |
|        `kitsu` |       17.7 kb      |  6+  |   52+  |   47+   |   10+  |  14+ |     |
| `kitsu/legacy` |       19.8 kb      |  6+  |   4+   |    3+   |  3.2+  |  12+ |  8+ |
|   `kitsu/node` |       14.7 kb      |  6+  |        |         |        |      |     |

\* Including all dependencies, minified & gzipped

[default]: http://browserl.ist/?q=last+2+years%2C+not+%3C+0.05%25

[legacy]: http://browserl.ist/?q=last+10+years

## Response Comparison

<details>
<summary>A GET response by a JSON:API server</summary>

```json5
{
  data: {
    id: '1'
    type: 'articles'
    attributes: {
      title: 'JSON API paints my bikeshed'
    }
    relationships: {
      author: {
        data: {
          id: '42'
          type: 'people'
        }
      }
    }
  }
  included: [
    {
      id: '42'
      type: 'people'
      attributes: {
        name: 'John'
      }
    }
  ]
}
```

</details>

<details open>
<summary>A GET response with kitsu:</summary>

```json5
{
  data: {
    id: '1'
    type: 'articles'
    title: 'JSON API paints my bikeshed'
    author: {
      id: '42'
      type: 'people'
      name: 'John'
    }
  }
}
```

</details>

## Install

### Yarn / NPM

```bash
yarn add kitsu
npm install kitsu
```

```js
import Kitsu from 'kitsu'             // ES Modules and Babel
const Kitsu = require('kitsu')        // CommonJS and Browserify
const Kitsu = require('kitsu/legacy') // Legacy IE8+ support
const Kitsu = require('kitsu/node')   // Lighter node-only package
```

[Try it on RunKit](https://npm.runkit.com/kitsu)

### Packd CDN

```html
<script src='https://bundle.run/kitsu@5?name=Kitsu'></script>
<script src='https://bundle.run/kitsu@5/legacy/index.js?name=Kitsu'></script>
```

[Try it on CodePen](https://codepen.io/wopian/pen/RxmEeK?editors=0010)

## Quick Start

```javascript
// Kitsu.io's API
const api = new Kitsu()

// Other JSON:API servers
const api = new Kitsu({
  baseURL: 'https://api.example/2'
})

// Using with async/await
const res = await api.get('anime')

// Using with Promises
api.get('anime')
  .then(res => { ... })
  .catch(err => { ... })

// Fetching resources (get/fetch)
api.fetch('anime')
api.fetch('anime/1')
api.fetch('anime/1/episodes')

// Creating resources (post/create)
api.create('post', {
  content: 'some content'
})

// Updating resources (patch/update)
api.update('post', {
  id: '1',
  content: 'new content'
})

// Deleting resources
api.remove('post', 1)
```

[More Examples]

If you're working with [Kitsu.io]'s API, their [API docs][kitsu.io api docs] lists all available resources with their attributes and relationships

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [Kitsu](#kitsu)
    -   [get](#get)
    -   [headers](#headers)
    -   [patch](#patch)
    -   [plural](#plural)
    -   [post](#post)
    -   [remove](#remove)
    -   [self](#self)

### Kitsu

Creates a new `kitsu` instance

**Parameters**

-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options (optional, default `{}`)
    -   `options.baseURL` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Set the API endpoint (default `https://kitsu.io/api/edge`)
    -   `options.headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with requests
    -   `options.camelCaseTypes` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, the `type` value will be camelCased, e.g `library-entries` and `library_entries` become `libraryEntries`  (default `true`)
    -   `options.resourceCase` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** `kebab`, `snake` or `none`. If `kebab`, `/libraryEntries` will become `/library-entries`. If `snake`, `/libraryEntries` will become `/library_entries`, If `none`, `/libraryEntries` will be unchanged (default `kebab`)
    -   `options.pluralize` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If `true`, `/user` will become `/users` in the URL request and `type` will be pluralized in post, patch and delete requests - `user` -> `users` (default `true`)
    -   `options.timeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Set the request timeout in milliseconds (default `30000`)

**Examples**

_Using with Kitsu.io's API_

```javascript
const api = new Kitsu()
```

_Using another API server_

```javascript
const api = new Kitsu({
  baseURL: 'https://api.example.org/2'
})
```

_Setting headers_

```javascript
const api = new Kitsu({
  headers: {
    'User-Agent': 'MyApp/1.0.0 (github.com/username/repo)',
    Authorization: 'Bearer 1234567890'
  }
})
```

#### get

Fetch resources (alias `fetch`)

**Parameters**

-   `model` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Model to fetch data from
-   `params` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-API request queries (optional, default `{}`)
    -   `params.page` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [JSON:API Pagination](http://jsonapi.org/format/#fetching-pagination)
        -   `params.page.limit` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of resources to return in request (Max `20` for Kitsu.io except on `libraryEntries` which has a max of `500`)
        -   `params.page.offset` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of resources to offset the dataset by
    -   `params.fields` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Return a sparse fieldset with only the included attributes/relationships - [JSON:API Sparse Fieldsets](http://jsonapi.org/format/#fetching-sparse-fieldsets)
    -   `params.filter` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Filter dataset by attribute values - [JSON:API Filtering](http://jsonapi.org/format/#fetching-filtering)
    -   `params.sort` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Sort dataset by one or more comma separated attributes (prepend `-` for descending order) - [JSON:API Sorting](http://jsonapi.org/format/#fetching-sorting)
    -   `params.include` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Include relationship data - [JSON:API Includes](http://jsonapi.org/format/#fetching-includes)
-   `headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with request (optional, default `{}`)

**Examples**

_Getting a resource with JSON:API parameters_

```javascript
api.get('users', {
  fields: {
    users: 'name,birthday'
  },
  filter: {
    name: 'wopian'
  }
})
```

_Getting a collection of resources with their relationships_

```javascript
api.get('anime', {
  include: 'categories'
})
```

_Getting a single resource by ID (method one)_

```javascript
api.get('anime/2', {
  include: 'categories'
})
```

_Getting a single resource by ID (method two)_

```javascript
api.get('anime', {
  include: 'categories',
  filter: { id: '2' }
})
```

_Getting a resource's relationship data only_

```javascript
api.get('anime/2/categories')
```

_Handling errors (async/await)_

```javascript
try {
  const { data } = await api.get('anime')
} catch (err) {
  // Array of JSON:API errors: http://jsonapi.org/format/#error-objects
  if (err.errors) err.errors.forEach(error => { ... })
  // Error type (Error, TypeError etc.)
  err.name
  // Error message
  err.message
  // Axios request parameters
  err.config
  // Axios response parameters
  err.response
}
```

_Handling errors (Promises)_

```javascript
api.get('anime')
  .then(({ data }) => { ... })
  .catch(err => {
    // Array of JSON:API errors: http://jsonapi.org/format/#error-objects
    if (err.errors) err.errors.forEach(error => { ... })
    // Error type (Error, TypeError etc.)
    err.name
    // Error message
    err.message
    // Axios request parameters
    err.config
    // Axios response parameters
    err.response
  })
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-parsed response

#### headers

Get the current headers or add additional headers

**Examples**

_Get all headers_

```javascript
api.headers
```

_Get a single header's value_

```javascript
api.headers['User-Agent']
```

_Add or update a header's value_

```javascript
api.headers['Authorization'] = 'Bearer 1234567890'
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** All the current headers

#### patch

Update a resource (alias `update`)

**Parameters**

-   `model` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Model to update data in
-   `body` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Data to send in the request
-   `headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with request (optional, default `{}`)

**Examples**

_Update a post_

```javascript
api.update('posts', {
  id: '12345678',
  content: 'Goodbye World'
})
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-parsed response

#### plural

-   **See: <https://www.npmjs.com/package/pluralize> for documentation**
-   **See: Kitsu constructor options for disabling pluralization**

If pluralization is enabled (default, see Kitsu constructor docs) then pluralization rules can be added

**Examples**

_Adding an uncountable pluralization rule_

```javascript
api.plural.plural('paper') //=> 'papers'
api.plural.addUncountableRule('paper')
api.plural.plural('paper') //=> 'paper'
```

#### post

Create a new resource (alias `create`)

**Parameters**

-   `model` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Model to create a resource under
-   `body` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Data to send in the request
-   `headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with request (optional, default `{}`)

**Examples**

_Create a post on a user's profile feed_

```javascript
api.create('posts', {
  content: 'Hello World',
  targetUser: {
    id: '42603',
    type: 'users'
  },
  user: {
    id: '42603',
    type: 'users'
  }
})
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-parsed response

#### remove

Remove a resource

**Parameters**

-   `model` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Model to remove data from
-   `id` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number))** Resource ID to remove
-   `headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with request (optional, default `{}`)

**Examples**

_Remove a user's post_

```javascript
api.remove('posts', 123)
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-parsed response

#### self

Get the authenticated user's data

**Note** Requires the JSON:API server to support `filter[self]=true`

**Parameters**

-   `params` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-API request queries (optional, default `{}`)
    -   `params.fields` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Return a sparse fieldset with only the included attributes/relationships - [JSON:API Sparse Fieldsets](http://jsonapi.org/format/#fetching-sparse-fieldsets)
    -   `params.include` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Include relationship data - [JSON:API Includes](http://jsonapi.org/format/#fetching-includes)
-   `headers` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Additional headers to send with request (optional, default `{}`)

**Examples**

_Get the authenticated user's resource_

```javascript
api.self()
```

_Using JSON:API parameters_

```javascript
api.self({
  fields: {
    users: 'name,birthday'
  }
})
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** JSON-parsed response

## Contributing

See [CONTRIBUTING]

## Releases

See [CHANGELOG]

## License

All code released under [MIT]

[kitsu.io]: https://kitsu.io

[json:api]: http://jsonapi.org

[promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises

[more examples]: https://github.com/wopian/kitsu/tree/master/example

[kitsu.io api docs]: https://kitsu.docs.apiary.io

[migration guide]: https://github.com/wopian/kitsu/blob/master/MIGRATING.md

[changelog]: https://github.com/wopian/kitsu/blob/master/packages/kitsu/CHANGELOG.md

[contributing]: https://github.com/wopian/kitsu/blob/master/CONTRIBUTING.md

[mit]: https://github.com/wopian/kitsu/blob/master/LICENSE.md

[npm]: https://www.npmjs.com/package/kitsu

[npm badge]: https://img.shields.io/npm/v/kitsu.svg?style=flat-square

[npm install badge]: https://img.shields.io/npm/dt/kitsu.svg?style=flat-square

[travis]: https://travis-ci.org/wopian/kitsu

[travis badge]: https://img.shields.io/travis/wopian/kitsu/master.svg?style=flat-square&label=linux%20%26%20macOS

[appveyor]: https://ci.appveyor.com/project/wopian/kitsu

[appveyor badge]: https://img.shields.io/appveyor/ci/wopian/kitsu/master.svg?style=flat-square&label=windows

[cc coverage]: https://codeclimate.com/github/wopian/kitsu/code

[cc coverage badge]: https://img.shields.io/codeclimate/c/wopian/kitsu.svg?style=flat-square

[cc maintainability]: https://codeclimate.com/github/wopian/kitsu

[cc maintainability badge]: https://img.shields.io/codeclimate/maintainability/wopian/kitsu.svg?style=flat-square

[david]: https://david-dm.org/wopian/kitsu?path=packages/kitsu

[david badge]: https://david-dm.org/wopian/kitsu/status.svg?path=packages/kitsu&style=flat-square

[david dev]: https://david-dm.org/wopian/kitsu?type=dev

[david dev badge]: https://img.shields.io/david/dev/wopian/kitsu.svg?style=flat-square

[contributors]: https://github.com/wopian/kitsu/graphs/contributors

[contributors badge]: https://img.shields.io/github/contributors/wopian/kitsu.svg?style=flat-square

[donate]: https://www.patreon.com/wopian

[donate badge]: https://img.shields.io/badge/patreon-donate-ff69b4.svg?style=flat-square
